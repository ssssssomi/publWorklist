<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no, address=no, email=no">
  <title>WORKLIST</title>

  <link rel="stylesheet" type="text/css" href="./assets/css/common.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
</head>

<body class="ui-content" data-page="worklist" data-theme="light">
  <div class="worklist-wrap">

    <header class="worklist-head">
      <h1 class="worklist-title">í¼ë¸”ë¦¬ì‹± ì›Œí¬ë¦¬ìŠ¤íŠ¸</h1>

      <div class="worklist-toolbar">
        <div class="worklist-meta" role="search" aria-label="ì›Œí¬ë¦¬ìŠ¤íŠ¸ í•„í„°">
          <div class="field">
            <label for="wlSearch">ê²€ìƒ‰</label>
            <input
              id="wlSearch"
              type="search"
              placeholder="í™”ë©´ ID, í™”ë©´ëª…, ê²½ë¡œ, íŒŒì¼ëª… ê²€ìƒ‰"
              autocomplete="off"
            >
          </div>

          <div class="field">
            <label for="wlStatusNative">ìƒíƒœ</label>

            <select id="wlStatusNative" class="wl-native--select">
              <option value="all" selected>ì „ì²´</option>
              <option value="todo">ì˜ˆì •</option>
              <option value="progress">ì§„í–‰ì¤‘</option>
              <option value="done">ì™„ë£Œ</option>
            </select>

            <div class="wl-select" data-select>
              <button
                type="button"
                class="wl-select--btn"
                id="wlStatusBtn"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-controls="wlStatusList"
              >
                <span class="wl-select--value" data-value-text>ì „ì²´</span>
                <span class="wl-select--chev" aria-hidden="true">â–¾</span>
              </button>

              <ul
                class="wl-select--list"
                id="wlStatusList"
                role="listbox"
                tabindex="-1"
                aria-label="ìƒíƒœ ì„ íƒ"
                hidden
              >
                <li class="wl-select--opt" role="option" tabindex="-1" data-value="all" aria-selected="true">
                  <span class="wl-select--check" aria-hidden="true">âœ“</span> ì „ì²´
                </li>
                <li class="wl-select--opt" role="option" tabindex="-1" data-value="todo" aria-selected="false">
                  <span class="wl-select--check" aria-hidden="true">âœ“</span> ì˜ˆì •
                </li>
                <li class="wl-select--opt" role="option" tabindex="-1" data-value="progress" aria-selected="false">
                  <span class="wl-select--check" aria-hidden="true">âœ“</span> ì§„í–‰ì¤‘
                </li>
                <li class="wl-select--opt" role="option" tabindex="-1" data-value="done" aria-selected="false">
                  <span class="wl-select--check" aria-hidden="true">âœ“</span> ì™„ë£Œ
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="worklist-actions">
          <button
            type="button"
            class="btn-theme"
            id="btnTheme"
            aria-pressed="false"
            aria-label="ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜"
            title="í…Œë§ˆ ì „í™˜"
          >
            <span class="btn-theme--icon" aria-hidden="true">ğŸŒ™</span>
            <span class="btn-theme--text">Dark</span>
          </button>
        </div>
      </div>
    </header>

    <div class="worklist-summary" aria-live="polite" aria-atomic="true">
      <span class="summary-item">ì „ì²´ <strong id="countAll">0</strong></span>
      <span class="summary-item">í‘œì‹œ <strong id="countVisible">0</strong></span>
      <span class="summary-item">ì™„ë£Œ <strong id="countDone">0</strong></span>
      <span class="summary-item">ì§„í–‰ <strong id="countProgress">0</strong></span>
      <span class="summary-item">ì˜ˆì • <strong id="countTodo">0</strong></span>
    </div>

    <div class="worklist-table--wrap" role="region" aria-label="í¼ë¸”ë¦¬ì‹± ì›Œí¬ë¦¬ìŠ¤íŠ¸ í‘œ" tabindex="0">
      <table class="worklist-table">
        <caption>í™”ë©´ë³„ í¼ë¸”ë¦¬ì‹± í˜„í™© ë° ë¯¸ë¦¬ë³´ê¸°</caption>
        <thead>
          <tr>
            <th scope="col" class="col-no">No</th>
            <th scope="col" class="col-id">í™”ë©´ ID</th>
            <th scope="col" class="col-preview">ë¯¸ë¦¬ë³´ê¸°</th>
            <th scope="col" class="col-new">ìƒˆì°½</th>
            <th scope="col" class="col-d1">1Depth</th>
            <th scope="col" class="col-d2">2Depth</th>
            <th scope="col" class="col-name">í™”ë©´ëª…</th>
            <th scope="col" class="col-path">ê²½ë¡œ(URL)</th>
            <th scope="col" class="col-file">íŒŒì¼ëª…</th>
            <th scope="col" class="col-status">ìƒíƒœ</th>
            <th scope="col" class="col-note">ë¹„ê³ </th>
          </tr>
        </thead>

        <tbody id="wlTbody">
          <tr data-status="done">
            <th scope="row" class="col-no">1</th>
            <td class="col-id"><strong>MAIN_001</strong></td>
            <td class="col-preview">
              <button
                type="button"
                class="btn-preview"
                data-preview-src="./html/MAIN_001.html"
                data-preview-title="MAIN_001 ë©”ì¸"
                aria-haspopup="dialog"
                aria-controls="previewDialog"
              >
                <span class="btn-preview--icon" aria-hidden="true">ğŸ”</span>
                <span class="btn-preview--text">ë³´ê¸°</span>
              </button>
            </td>
            <td class="col-new">
              <a class="btn-newtab" href="./html/MAIN_001.html" target="_blank" rel="noopener">ìƒˆì°½</a>
            </td>
            <td class="col-d1">ë©”ì¸</td>
            <td class="col-d2">-</td>
            <td class="col-name">ë©”ì¸</td>
            <td class="col-path">/</td>
            <td class="col-file">main.html</td>
            <td class="col-status"><span class="status" data-status="done">ì™„ë£Œ</span></td>
            <td class="col-note"></td>
          </tr>

          <tr data-status="progress">
            <th scope="row" class="col-no">2</th>
            <td class="col-id"><strong>CS_001</strong></td>
            <td class="col-preview">
              <button
                type="button"
                class="btn-preview"
                data-preview-src="./html/CS_001.html"
                data-preview-title="CS_001 FAQ ëª©ë¡"
                aria-haspopup="dialog"
                aria-controls="previewDialog"
              >
                <span class="btn-preview--icon" aria-hidden="true">ğŸ”</span>
                <span class="btn-preview--text">ë³´ê¸°</span>
              </button>
            </td>
            <td class="col-new">
              <a class="btn-newtab" href="./html/CS_001.html" target="_blank" rel="noopener">ìƒˆì°½</a>
            </td>
            <td class="col-d1">ê³ ê°ì„¼í„°</td>
            <td class="col-d2">FAQ</td>
            <td class="col-name">FAQ ëª©ë¡</td>
            <td class="col-path">/cs/faq</td>
            <td class="col-file">CS_001.html</td>
            <td class="col-status"><span class="status" data-status="progress">ì§„í–‰ì¤‘</span></td>
            <td class="col-note">ê²€ìƒ‰ í¬í•¨</td>
          </tr>

          <tr data-status="todo">
            <th scope="row" class="col-no">3</th>
            <td class="col-id"><strong>CS_002</strong></td>
            <td class="col-preview">
              <button
                type="button"
                class="btn-preview"
                data-preview-src="./html/CS_002.html"
                data-preview-title="CS_002 FAQ ìƒì„¸"
                aria-haspopup="dialog"
                aria-controls="previewDialog"
              >
                <span class="btn-preview--icon" aria-hidden="true">ğŸ”</span>
                <span class="btn-preview--text">ë³´ê¸°</span>
              </button>
            </td>
            <td class="col-new">
              <a class="btn-newtab" href="./html/CS_002.html" target="_blank" rel="noopener">ìƒˆì°½</a>
            </td>
            <td class="col-d1">ê³ ê°ì„¼í„°</td>
            <td class="col-d2">FAQ</td>
            <td class="col-name">FAQ ìƒì„¸</td>
            <td class="col-path">/cs/faq/view</td>
            <td class="col-file">CS_002.html</td>
            <td class="col-status"><span class="status" data-status="todo">ì˜ˆì •</span></td>
            <td class="col-note"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="publ-guide--link">
      <a
        href="./publ-guide.html"
        target="_blank"
        rel="noopener"
        aria-label="í¼ë¸”ë¦¬ì‹± ê°€ì´ë“œ ìƒˆ ì°½ ì—´ë¦¼"
      >
        <span>Guide</span>
      </a>
    </div>

    <!-- Preview Dialog -->
    <div class="dialog-backdrop" id="dialogBackdrop" hidden></div>

    <section
      class="dialog"
      id="previewDialog"
      role="dialog"
      aria-modal="true"
      aria-labelledby="previewTitle"
      aria-describedby="previewDesc"
      hidden
    >
      <div class="dialog-panel" role="document">
        <div class="dialog-head">
          <h2 class="dialog-title" id="previewTitle">ë¯¸ë¦¬ë³´ê¸°</h2>

          <div class="dialog-actions">
            <button type="button" class="btn-close" id="btnClosePreview">ë‹«ê¸°</button>
          </div>
        </div>

        <div class="dialog-body">
          <iframe class="preview-frame" id="previewFrame" title="ë¯¸ë¦¬ë³´ê¸° í”„ë ˆì„"></iframe>
        </div>

        <p class="dialog-note" id="previewDesc">
          Esc í‚¤ë¡œ ë‹«ì„ ìˆ˜ ìˆìœ¼ë©°, ë‹«ê¸° í›„ í¬ì»¤ìŠ¤ëŠ” ì´ì „ ë²„íŠ¼ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
        </p>
      </div>
    </section>

  </div>

  <script>
    (function () {
      const tbody = document.getElementById('wlTbody');

      const searchEl = document.getElementById('wlSearch');

      // âœ… ìƒíƒœ(ì»¤ìŠ¤í…€) ê´€ë ¨
      const statusNative = document.getElementById('wlStatusNative');
      const statusSelect = document.querySelector('[data-select]');
      const statusBtn = document.getElementById('wlStatusBtn');
      const statusList = document.getElementById('wlStatusList');
      const statusValueText = statusSelect ? statusSelect.querySelector('[data-value-text]') : null;
      const statusOptions = statusList ? Array.from(statusList.querySelectorAll('.wl-select--opt')) : [];

      const countAllEl = document.getElementById('countAll');
      const countVisibleEl = document.getElementById('countVisible');
      const countDoneEl = document.getElementById('countDone');
      const countProgressEl = document.getElementById('countProgress');
      const countTodoEl = document.getElementById('countTodo');

      const dialog = document.getElementById('previewDialog');
      const backdrop = document.getElementById('dialogBackdrop');
      const frame = document.getElementById('previewFrame');
      const titleEl = document.getElementById('previewTitle');
      const closeBtn = document.getElementById('btnClosePreview');

      const themeBtn = document.getElementById('btnTheme');
      const THEME_KEY = 'publ_theme';
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

      let lastFocusEl = null;

      function setTheme(theme) {
        document.body.setAttribute('data-theme', theme);
        const isDark = theme === 'dark';

        if (themeBtn) {
          themeBtn.setAttribute('aria-pressed', String(isDark));
          themeBtn.setAttribute('aria-label', isDark ? 'ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜' : 'ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜');

          const icon = themeBtn.querySelector('.btn-theme--icon');
          const text = themeBtn.querySelector('.btn-theme--text');
          if (icon) icon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
          if (text) text.textContent = isDark ? 'Light' : 'Dark';
        }
      }

      function getInitialTheme() {
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === 'light' || saved === 'dark') return saved;
        return (prefersDark && prefersDark.matches) ? 'dark' : 'light';
      }

      setTheme(getInitialTheme());

      if (prefersDark && prefersDark.addEventListener) {
        prefersDark.addEventListener('change', (e) => {
          const saved = localStorage.getItem(THEME_KEY);
          if (saved === 'light' || saved === 'dark') return;
          setTheme(e.matches ? 'dark' : 'light');
        });
      }

      if (themeBtn) {
        themeBtn.addEventListener('click', () => {
          const current = document.body.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          localStorage.setItem(THEME_KEY, next);
          setTheme(next);
        });
      }

      function getFocusable(root) {
        return Array.from(
          root.querySelectorAll(
            'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
          )
        );
      }

      function openDialog(src, title) {
        lastFocusEl = document.activeElement;

        titleEl.textContent = title || 'ë¯¸ë¦¬ë³´ê¸°';
        frame.src = src || '';

        dialog.hidden = false;
        backdrop.hidden = false;

        document.documentElement.style.overflow = 'hidden';
        closeBtn.focus();
      }

      function closeDialog() {
        dialog.hidden = true;
        backdrop.hidden = true;
        frame.src = 'about:blank';

        document.documentElement.style.overflow = '';

        if (lastFocusEl && typeof lastFocusEl.focus === 'function') {
          lastFocusEl.focus();
        }
      }

      tbody.addEventListener('click', (e) => {
        const btn = e.target.closest('.btn-preview');
        if (!btn) return;

        const src = btn.getAttribute('data-preview-src');
        const title = btn.getAttribute('data-preview-title');
        openDialog(src, title);
      });

      closeBtn.addEventListener('click', closeDialog);
      backdrop.addEventListener('click', closeDialog);

      document.addEventListener('keydown', (e) => {
        if (dialog.hidden) return;

        if (e.key === 'Escape') {
          e.preventDefault();
          closeDialog();
          return;
        }

        if (e.key === 'Tab') {
          const focusables = getFocusable(dialog);
          if (!focusables.length) return;

          const first = focusables[0];
          const last = focusables[focusables.length - 1];

          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      });

      // âœ… ì»¤ìŠ¤í…€ ìƒíƒœ select
      function getStatusValue() {
        return statusNative ? statusNative.value : 'all';
      }

      function setStatusValue(value) {
        if (!statusNative) return;
        statusNative.value = value;

        const opt = statusOptions.find(o => o.dataset.value === value);
        if (statusValueText && opt) {
          statusValueText.textContent = opt.textContent.replace('âœ“', '').trim();
        }
        statusOptions.forEach(o => o.setAttribute('aria-selected', String(o.dataset.value === value)));
      }

      function openSelect() {
        if (!statusSelect || !statusList) return;
        statusSelect.classList.add('is-open');
        statusBtn.setAttribute('aria-expanded', 'true');
        statusList.hidden = false;

        const current = getStatusValue();
        const currentOpt = statusOptions.find(o => o.dataset.value === current) || statusOptions[0];
        statusList.focus();
        currentOpt && currentOpt.focus();
      }

      function closeSelect(focusBtn = true) {
        if (!statusSelect || !statusList) return;
        statusSelect.classList.remove('is-open');
        statusBtn.setAttribute('aria-expanded', 'false');
        statusList.hidden = true;
        if (focusBtn) statusBtn.focus();
      }

      function moveFocus(delta) {
        const active = document.activeElement;
        const idx = statusOptions.indexOf(active);
        const next = statusOptions[Math.max(0, Math.min(statusOptions.length - 1, (idx < 0 ? 0 : idx + delta)))];
        next && next.focus();
      }

      if (statusBtn && statusList) {
        statusBtn.addEventListener('click', () => {
          const expanded = statusBtn.getAttribute('aria-expanded') === 'true';
          expanded ? closeSelect(false) : openSelect();
        });

        statusList.addEventListener('click', (e) => {
          const opt = e.target.closest('.wl-select--opt');
          if (!opt) return;
          setStatusValue(opt.dataset.value);
          closeSelect(true);
          applyFilter();
        });

        statusList.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') { e.preventDefault(); closeSelect(true); return; }
          if (e.key === 'ArrowDown') { e.preventDefault(); moveFocus(1); return; }
          if (e.key === 'ArrowUp') { e.preventDefault(); moveFocus(-1); return; }
          if (e.key === 'Home') { e.preventDefault(); statusOptions[0]?.focus(); return; }
          if (e.key === 'End') { e.preventDefault(); statusOptions[statusOptions.length - 1]?.focus(); return; }
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const opt = document.activeElement && document.activeElement.closest('.wl-select--opt');
            if (!opt) return;
            setStatusValue(opt.dataset.value);
            closeSelect(true);
            applyFilter();
          }
        });

        document.addEventListener('click', (e) => {
          if (statusList.hidden) return;
          if (statusSelect.contains(e.target)) return;
          closeSelect(false);
        });
      }

      function counts() {
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const all = rows.length;

        const done = rows.filter(r => r.dataset.status === 'done').length;
        const progress = rows.filter(r => r.dataset.status === 'progress').length;
        const todo = rows.filter(r => r.dataset.status === 'todo').length;

        const visible = rows.filter(r => r.style.display !== 'none').length;

        if (countAllEl) countAllEl.textContent = String(all);
        if (countVisibleEl) countVisibleEl.textContent = String(visible);
        if (countDoneEl) countDoneEl.textContent = String(done);
        if (countProgressEl) countProgressEl.textContent = String(progress);
        if (countTodoEl) countTodoEl.textContent = String(todo);
      }

      function applyFilter() {
        const q = (searchEl.value || '').trim().toLowerCase();
        const st = getStatusValue();

        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.forEach((row) => {
          const rowStatus = row.dataset.status || '';
          const text = row.textContent.toLowerCase();

          const matchStatus = (st === 'all') ? true : rowStatus === st;
          const matchQuery = q ? text.includes(q) : true;

          row.style.display = (matchStatus && matchQuery) ? '' : 'none';
        });

        counts();
      }

      searchEl.addEventListener('input', applyFilter);

      // ì´ˆê¸° ìƒíƒœ í‘œì‹œ ë™ê¸°í™” + ì¹´ìš´íŠ¸
      setStatusValue(getStatusValue());
      counts();
    })();
  </script>
</body>
</html>
