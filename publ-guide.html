<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no, address=no, email=no" />
  <title>Publish Guide</title>
  <link rel="stylesheet" type="text/css" href="./assets/css/common.css" />
</head>

<body class="ui-content" data-page="publ-guide">
  <div class="guide-wrap">
    <main class="pub-body">
      <!-- TAB -->
      <div class="pub-wrap" data-gap="full">
        <div class="pub-tab">
          <div class="pub-tab--wrap" role="tablist" aria-label="퍼블리싱 가이드 컴포넌트 탭">
            <button type="button" class="pub-tab--btn" role="tab" aria-controls="pnl-popup"
              data-tab="guide" data-id="popup">
              <span>popup</span>
            </button>

            <button type="button" class="pub-tab--btn" role="tab" aria-controls="pnl-swiper"
              data-tab="guide" data-id="swiper">
              <span>swiper</span>
            </button>
          </div>
        </div>
      </div>

      <!-- PANEL -->
      <div class="pub-wrap--in mt-x4">
        <div>
          <section class="pub-tab--pnl" id="pnl-popup" role="tabpanel" tabindex="0"
            data-tab="guide" data-id="popup" aria-hidden="true">
            <h1 class="a11y-hidden">popup</h1>
            async: true
          </section>

          <section class="pub-tab--pnl" id="pnl-swiper" role="tabpanel" tabindex="0"
            data-tab="guide" data-id="swiper" aria-hidden="true">
            <h1 class="a11y-hidden">swiper</h1>
            async: true
          </section>
        </div>
      </div>
    </main>
  </div>

  <script defer src="./assets/js/ui-script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tabWrap = document.querySelector('.pub-tab--wrap');
      if (!tabWrap) return;

      const panels = document.querySelectorAll('.pub-tab--pnl[data-tab="guide"]');

      const setActive = (id) => {
        tabWrap.querySelectorAll('.pub-tab--btn').forEach(btn => {
          const isOn = btn.dataset.id === id;
          btn.classList.toggle('is-active', isOn);
          btn.setAttribute('aria-selected', String(isOn));
          btn.setAttribute('tabindex', isOn ? '0' : '-1');
        });

        panels.forEach(pnl => {
          const isOn = pnl.dataset.id === id;
          pnl.setAttribute('aria-hidden', String(!isOn));
          if (isOn) pnl.focus({ preventScroll: true });
        });
      };

      const loadPanel = async (id) => {
        const pnl = document.querySelector('.pub-tab--pnl[data-id="' + id + '"]');
        if (!pnl) return;

        const link = './component/' + id + '.html';

        try {
          const res = await fetch(link, { cache: 'no-cache' });
          if (!res.ok) throw new Error('HTTP ' + res.status);

          const html = await res.text();
          pnl.innerHTML = html;

          // ✅ 여기서 "해당 탭 콘텐츠가 DOM에 붙은 다음" init
          if (id === 'popup') {
            uiScript.popup.init();
          }

          // swiper도 같은 방식으로 붙이면 됨
          if (id === 'swiper') {
            // uiScript.swiper.init(); // swiper 모듈 만들면 여기서 호출
          }
        } catch (e) {
          pnl.innerHTML =
            '<p role="alert">콘텐츠를 불러오지 못했습니다.<br>' +
            '<strong>경로:</strong> ' + link + '</p>';
          console.error('[guide] fetch failed:', link, e);
        }
      };

      tabWrap.addEventListener('click', async (e) => {
        const btn = e.target.closest('.pub-tab--btn');
        if (!btn) return;

        const id = btn.dataset.id;
        if (!id) return;

        setActive(id);
        await loadPanel(id);
      });

      // 초기 진입
      const initial = 'popup';
      setActive(initial);
      loadPanel(initial);
    });
  </script>
</body>
</html>
